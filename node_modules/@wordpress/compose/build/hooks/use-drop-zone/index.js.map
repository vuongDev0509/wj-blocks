{"version":3,"sources":["@wordpress/compose/src/hooks/use-drop-zone/index.js"],"names":["useFreshRef","value","ref","current","useDropZone","isDisabled","_onDrop","onDrop","_onDragStart","onDragStart","_onDragEnter","onDragEnter","_onDragLeave","onDragLeave","_onDragEnd","onDragEnd","_onDragOver","onDragOver","onDropRef","onDragStartRef","onDragEnterRef","onDragLeaveRef","onDragEndRef","onDragOverRef","element","isDragging","ownerDocument","maybeDragStart","event","removeEventListener","preventDefault","contains","relatedTarget","defaultPrevented","dataTransfer","files","length","maybeDragEnd","addEventListener"],"mappings":"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","sourcesContent":["/**\n * WordPress dependencies\n */\nimport { useRef } from '@wordpress/element';\n\n/**\n * Internal dependencies\n */\nimport useRefEffect from '../use-ref-effect';\n\n/** @typedef {import('@wordpress/element').RefCallback} RefCallback */\n\nfunction useFreshRef( value ) {\n\tconst ref = useRef();\n\tref.current = value;\n\treturn ref;\n}\n\n/**\n * A hook to facilitate drag and drop handling.\n *\n * @param {Object}     $1             Named parameters.\n * @param {boolean}    $1.isDisabled  Whether or not to disable the drop zone.\n * @param {DragEvent}  $1.onDragStart Called when dragging has started.\n * @param {DragEvent}  $1.onDragEnter Called when the zone is entered.\n * @param {DragEvent}  $1.onDragOver  Called when the zone is moved within.\n * @param {DragEvent}  $1.onDragLeave Called when the zone is left.\n * @param {MouseEvent} $1.onDragEnd   Called when dragging has ended.\n * @param {DragEvent}  $1.onDrop      Called when dropping in the zone.\n *\n * @return {RefCallback} Ref callback to be passed to the drop zone element.\n */\nexport default function useDropZone( {\n\tisDisabled,\n\tonDrop: _onDrop,\n\tonDragStart: _onDragStart,\n\tonDragEnter: _onDragEnter,\n\tonDragLeave: _onDragLeave,\n\tonDragEnd: _onDragEnd,\n\tonDragOver: _onDragOver,\n} ) {\n\tconst onDropRef = useFreshRef( _onDrop );\n\tconst onDragStartRef = useFreshRef( _onDragStart );\n\tconst onDragEnterRef = useFreshRef( _onDragEnter );\n\tconst onDragLeaveRef = useFreshRef( _onDragLeave );\n\tconst onDragEndRef = useFreshRef( _onDragEnd );\n\tconst onDragOverRef = useFreshRef( _onDragOver );\n\n\treturn useRefEffect(\n\t\t( element ) => {\n\t\t\tif ( isDisabled ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlet isDragging = false;\n\n\t\t\tconst { ownerDocument } = element;\n\n\t\t\tfunction maybeDragStart( event ) {\n\t\t\t\tif ( isDragging ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tisDragging = true;\n\n\t\t\t\townerDocument.removeEventListener(\n\t\t\t\t\t'dragenter',\n\t\t\t\t\tmaybeDragStart\n\t\t\t\t);\n\n\t\t\t\tif ( onDragStartRef.current ) {\n\t\t\t\t\tonDragStartRef.current( event );\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction onDragEnter( event ) {\n\t\t\t\tevent.preventDefault();\n\n\t\t\t\t// The `dragenter` event will also fire when entering child\n\t\t\t\t// elements, but we only want to call `onDragEnter` when\n\t\t\t\t// entering the drop zone, which means the `relatedTarget`\n\t\t\t\t// (element that has been left) should be outside the drop zone.\n\t\t\t\tif ( element.contains( event.relatedTarget ) ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif ( onDragEnterRef.current ) {\n\t\t\t\t\tonDragEnterRef.current( event );\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction onDragOver( event ) {\n\t\t\t\t// Only call onDragOver for the innermost hovered drop zones.\n\t\t\t\tif ( ! event.defaultPrevented && onDragOverRef.current ) {\n\t\t\t\t\tonDragOverRef.current( event );\n\t\t\t\t}\n\n\t\t\t\t// Prevent the browser default while also signalling to parent\n\t\t\t\t// drop zones that `onDragOver` is already handled.\n\t\t\t\tevent.preventDefault();\n\t\t\t}\n\n\t\t\tfunction onDragLeave( event ) {\n\t\t\t\t// The `dragleave` event will also fire when leaving child\n\t\t\t\t// elements, but we only want to call `onDragLeave` when\n\t\t\t\t// leaving the drop zone, which means the `relatedTarget`\n\t\t\t\t// (element that has been entered) should be outside the drop\n\t\t\t\t// zone.\n\t\t\t\tif ( element.contains( event.relatedTarget ) ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif ( onDragLeaveRef.current ) {\n\t\t\t\t\tonDragLeaveRef.current( event );\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction onDrop( event ) {\n\t\t\t\t// Don't handle drop if an inner drop zone already handled it.\n\t\t\t\tif ( event.defaultPrevented ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Prevent the browser default while also signalling to parent\n\t\t\t\t// drop zones that `onDrop` is already handled.\n\t\t\t\tevent.preventDefault();\n\n\t\t\t\t// This seemingly useless line has been shown to resolve a\n\t\t\t\t// Safari issue where files dragged directly from the dock are\n\t\t\t\t// not recognized.\n\t\t\t\t// eslint-disable-next-line no-unused-expressions\n\t\t\t\tevent.dataTransfer && event.dataTransfer.files.length;\n\n\t\t\t\tif ( onDropRef.current ) {\n\t\t\t\t\tonDropRef.current( event );\n\t\t\t\t}\n\n\t\t\t\tmaybeDragEnd( event );\n\t\t\t}\n\n\t\t\tfunction maybeDragEnd( event ) {\n\t\t\t\tif ( ! isDragging ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tisDragging = false;\n\n\t\t\t\townerDocument.addEventListener( 'dragenter', maybeDragStart );\n\n\t\t\t\tif ( onDragEndRef.current ) {\n\t\t\t\t\tonDragEndRef.current( event );\n\t\t\t\t}\n\t\t\t}\n\n\t\t\telement.addEventListener( 'drop', onDrop );\n\t\t\telement.addEventListener( 'dragenter', onDragEnter );\n\t\t\telement.addEventListener( 'dragover', onDragOver );\n\t\t\telement.addEventListener( 'dragleave', onDragLeave );\n\t\t\t// Note that `dragend` doesn't fire consistently for file and HTML\n\t\t\t// drag  events where the drag origin is outside the browser window.\n\t\t\t// In Firefox it may also not fire if the originating node is\n\t\t\t// removed.\n\t\t\townerDocument.addEventListener( 'dragend', maybeDragEnd );\n\t\t\townerDocument.addEventListener( 'mouseup', maybeDragEnd );\n\t\t\t// The `dragstart` event doesn't fire if the drag started outside\n\t\t\t// the document.\n\t\t\townerDocument.addEventListener( 'dragenter', maybeDragStart );\n\n\t\t\treturn () => {\n\t\t\t\telement.removeEventListener( 'drop', onDrop );\n\t\t\t\telement.removeEventListener( 'dragenter', onDragEnter );\n\t\t\t\telement.removeEventListener( 'dragover', onDragOver );\n\t\t\t\telement.removeEventListener( 'dragleave', onDragLeave );\n\t\t\t\townerDocument.removeEventListener( 'dragend', maybeDragEnd );\n\t\t\t\townerDocument.removeEventListener( 'mouseup', maybeDragEnd );\n\t\t\t\townerDocument.addEventListener( 'dragenter', maybeDragStart );\n\t\t\t};\n\t\t},\n\t\t[ isDisabled ]\n\t);\n}\n"]}